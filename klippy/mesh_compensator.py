from math import fabs
from shutil import ReadError, copy2
from os import path, remove, getenv
import os, logging, io, collections
import re, glob, math
from . import manual_probe as ManualProbe, bed_mesh as BedMesh

#####
# RatOS
#####
class MeshCompensator:

	#####
	# Initialize
	#####
	def __init__(self, config):
		self.config = config
		self.printer = config.get_printer()
		self.name = config.get_name()
		self.gcode = self.printer.lookup_object('gcode')
		self.reactor = self.printer.get_reactor()

		self.contact_mesh = None
		self.pmgr = ProfileManager(self.config, self)

		self.enable_compensation = False

		self.load_settings()
		self.register_commands()
		self.register_handler()

	#####
	# Handler
	#####
	def register_handler(self):
		self.printer.register_event_handler("klippy:connect", self._connect)

	def _connect(self):
		self.bed_mesh = self.printer.lookup_object('bed_mesh')
		if "Contact" in self.pmgr.get_profiles():
			self.contact_mesh = self.pmgr.load_profile("Contact")

	def clear_compensations(self):
		self.z_compensations = []

	#####
	# Settings
	#####
	def load_settings(self):
		self.enable_compensation = True if self.config.get('enable_compensation', "false").lower() == "true" else False 
		
	def get_status(self, eventtime):
		return {'name': self.name}

	#####
	# Gcode commands
	#####
	def register_commands(self):
		self.gcode.register_command('COMPENSATE_BED_MESH', self.cmd_COMPENSATE_BED_MESH, desc=(self.desc_COMPENSATE_BED_MESH))

	desc_COMPENSATE_BED_MESH = "COMPENSATE_BED_MESH"
	def cmd_COMPENSATE_BED_MESH(self, gcmd):
		if self.contact_mesh:
			systime = self.printer.get_reactor().monotonic()
			if self.bed_mesh.z_mesh:
				profile_name = self.bed_mesh.z_mesh.get_profile_name()
				if profile_name != "Contact":
					points = self.bed_mesh.get_status(systime)["profiles"][profile_name]["points"]

					params = self.bed_mesh.z_mesh.get_mesh_params()

					min_x = params["min_x"]
					min_y = params["min_y"]
					max_x = params["max_x"]
					max_y = params["max_y"]
					x_count = params["y_count"]
					y_count = params["x_count"]
					x_step = ((max_x - min_x) / (x_count - 1))
					y_step = ((max_y - min_y) / (y_count - 1))

					line = ""
					for y in range(y_count):
						line += "#*# 	  "
						for x in range(x_count):
							x_pos = min_x + x * x_step
							y_pos = min_y + y * y_step
							z_val = points[y][x]
							contact_z = self.contact_mesh.calc_z(x_pos, y_pos)
							new_z = z_val - (z_val - contact_z)
							line += str(str(float("{:.6f}".format(new_z))))
							if x < x_count - 1:
								line += ", "
						line += "\n"
					self.gcode.respond_raw(str(line))

class ProfileManager:
    def __init__(self, config, bedmesh):
        self.name = "bed_mesh"
        self.printer = config.get_printer()
        self.gcode = self.printer.lookup_object('gcode')
        self.bedmesh = bedmesh
        self.profiles = {}
        self.incompatible_profiles = []
        # Fetch stored profiles from Config
        stored_profs = config.get_prefix_sections(self.name)
        stored_profs = [s for s in stored_profs
                        if s.get_name() != self.name]
        for profile in stored_profs:
            name = profile.get_name().split(' ', 1)[1]
            version = profile.getint('version', 0)
            if version != BedMesh.PROFILE_VERSION:
                logging.info(
                    "bed_mesh: Profile [%s] not compatible with this version\n"
                    "of bed_mesh.  Profile Version: %d Current Version: %d "
                    % (name, version, BedMesh.PROFILE_VERSION))
                self.incompatible_profiles.append(name)
                continue
            self.profiles[name] = {}
            zvals = profile.getlists('points', seps=(',', '\n'), parser=float)
            self.profiles[name]['points'] = zvals
            self.profiles[name]['mesh_params'] = params = \
                collections.OrderedDict()
            for key, t in BedMesh.PROFILE_OPTIONS.items():
                if t is int:
                    params[key] = profile.getint(key)
                elif t is float:
                    params[key] = profile.getfloat(key)
                elif t is str:
                    params[key] = profile.get(key)
    def get_profiles(self):
        return self.profiles
    def load_profile(self, prof_name):
        profile = self.profiles.get(prof_name, None)
        if profile is None:
            return None
        probed_matrix = profile['points']
        mesh_params = profile['mesh_params']
        z_mesh = BedMesh.ZMesh(mesh_params, prof_name)
        try:
            z_mesh.build_mesh(probed_matrix)
        except BedMesh.BedMeshError as e:
            raise self.gcode.error(str(e))
        return z_mesh

#####
# Loader
#####
def load_config(config):
	return MeshCompensator(config)

#*# [bed_mesh default_comp]
#*# version = 1
#*# points =
#*# 	  -0.012517, -0.014978, -0.017748, -0.021872, -0.025495, -0.028267, -0.030797, -0.033133, -0.036085, -0.039251, -0.040873, -0.041923, -0.039438, -0.036359, -0.031888, -0.028392, -0.025932, -0.026275, -0.027998, -0.031231, -0.034673, -0.037041, -0.039203, -0.040663, -0.04236, -0.044392, -0.046176, -0.047792, -0.050805, -0.054203, -0.059291, -0.064029, -0.06657, -0.066998, -0.063334, -0.058084, -0.051407, -0.04675, -0.042912, -0.043774, -0.045333, -0.04864, -0.051723, -0.05419, -0.056856, -0.059759, -0.063574, -0.067904, -0.070793, -0.07335
#*# 	  -0.017918, -0.020039, -0.022424, -0.025969, -0.029069, -0.031416, -0.033417, -0.035143, -0.037274, -0.039545, -0.040702, -0.041447, -0.039652, -0.037431, -0.03421, -0.031711, -0.029979, -0.03043, -0.031955, -0.034724, -0.037662, -0.039651, -0.041438, -0.042535, -0.043786, -0.045253, -0.046524, -0.047662, -0.049696, -0.051976, -0.055375, -0.058542, -0.060246, -0.060553, -0.05815, -0.054709, -0.050333, -0.04731, -0.044837, -0.045657, -0.046973, -0.049616, -0.052081, -0.054061, -0.056258, -0.058719, -0.061963, -0.065649, -0.06811, -0.070289
#*# 	  -0.024593, -0.026291, -0.028198, -0.031023, -0.033474, -0.035291, -0.03664, -0.037617, -0.038739, -0.039913, -0.040499, -0.040871, -0.039923, -0.038756, -0.037073, -0.035799, -0.034962, -0.035545, -0.036826, -0.039025, -0.041344, -0.042867, -0.044192, -0.044843, -0.045543, -0.046314, -0.046953, -0.047503, -0.048328, -0.049228, -0.050543, -0.05177, -0.052442, -0.052596, -0.05175, -0.050538, -0.048997, -0.047989, -0.047198, -0.047964, -0.048982, -0.050804, -0.052507, -0.053883, -0.0555, -0.057409, -0.05994, -0.062823, -0.06475, -0.066455
#*# 	  -0.033501, -0.034631, -0.035896, -0.037754, -0.039334, -0.040443, -0.040924, -0.040906, -0.040691, -0.040409, -0.040239, -0.040116, -0.040295, -0.040526, -0.040882, -0.041235, -0.041584, -0.042342, -0.043302, -0.044743, -0.046239, -0.047145, -0.047857, -0.047913, -0.047882, -0.047728, -0.047526, -0.047292, -0.046506, -0.045567, -0.044105, -0.042746, -0.04204, -0.041991, -0.043214, -0.044969, -0.047202, -0.048876, -0.050323, -0.051017, -0.051636, -0.052365, -0.053051, -0.053621, -0.054461, -0.055625, -0.057195, -0.058994, -0.060199, -0.061267
#*# 	  -0.039875, -0.040577, -0.041359, -0.042491, -0.043421, -0.044008, -0.04388, -0.043183, -0.042064, -0.040797, -0.040118, -0.039665, -0.040612, -0.041798, -0.043546, -0.045009, -0.046168, -0.047045, -0.047784, -0.048708, -0.049642, -0.050124, -0.050415, -0.050059, -0.04952, -0.048722, -0.047934, -0.047152, -0.045227, -0.042987, -0.039557, -0.036365, -0.03468, -0.034477, -0.037147, -0.040976, -0.045851, -0.0494, -0.052412, -0.053051, -0.053384, -0.053338, -0.053301, -0.053294, -0.053558, -0.054151, -0.054976, -0.055933, -0.056577, -0.05715
#*# 	  -0.04486, -0.0452, -0.045574, -0.046096, -0.046483, -0.046641, -0.046051, -0.044865, -0.043104, -0.041142, -0.040106, -0.039421, -0.040922, -0.042797, -0.045546, -0.047807, -0.049548, -0.050511, -0.051091, -0.051641, -0.05217, -0.052344, -0.052328, -0.051664, -0.050746, -0.049465, -0.048235, -0.047038, -0.044239, -0.040998, -0.036051, -0.031446, -0.029002, -0.028669, -0.032426, -0.037817, -0.044681, -0.049643, -0.053833, -0.054427, -0.05454, -0.0539, -0.053309, -0.052851, -0.05264, -0.052728, -0.052888, -0.05309, -0.053231, -0.053358
#*# 	  -0.045425, -0.045537, -0.045656, -0.045809, -0.045893, -0.045861, -0.045318, -0.044368, -0.042985, -0.041451, -0.040653, -0.040137, -0.041373, -0.042915, -0.045174, -0.047044, -0.048498, -0.049416, -0.050071, -0.050795, -0.051512, -0.051815, -0.051913, -0.051312, -0.050463, -0.049262, -0.048088, -0.046933, -0.044137, -0.040888, -0.03591, -0.031271, -0.028782, -0.028357, -0.031932, -0.037083, -0.043654, -0.048405, -0.052419, -0.053006, -0.053136, -0.052542, -0.051975, -0.051481, -0.051032, -0.050638, -0.050118, -0.049525, -0.04913, -0.048779
#*# 	  -0.045625, -0.045471, -0.045295, -0.045024, -0.044765, -0.044528, -0.044101, -0.043521, -0.042717, -0.041835, -0.041398, -0.041134, -0.041955, -0.042978, -0.044472, -0.04573, -0.046737, -0.047586, -0.048357, -0.049355, -0.050368, -0.050879, -0.051165, -0.050689, -0.049984, -0.048951, -0.047911, -0.046867, -0.044179, -0.041037, -0.036198, -0.031682, -0.029223, -0.028694, -0.031904, -0.036556, -0.042509, -0.046817, -0.05046, -0.051032, -0.051195, -0.050711, -0.050223, -0.049724, -0.049016, -0.048058, -0.046734, -0.045203, -0.044173, -0.043259
#*# 	  -0.045382, -0.044918, -0.044399, -0.043636, -0.042985, -0.042525, -0.042296, -0.04225, -0.042269, -0.04231, -0.042381, -0.042472, -0.042696, -0.042972, -0.043369, -0.043751, -0.044116, -0.044865, -0.045805, -0.047197, -0.048637, -0.049449, -0.050014, -0.049739, -0.049266, -0.048512, -0.047699, -0.046845, -0.044394, -0.041502, -0.037007, -0.032803, -0.030466, -0.029817, -0.032439, -0.036281, -0.041221, -0.044805, -0.04784, -0.048388, -0.048606, -0.048309, -0.047967, -0.047499, -0.046507, -0.044884, -0.042609, -0.039965, -0.038182, -0.036599
#*# 	  -0.045385, -0.044673, -0.043879, -0.04272, -0.041752, -0.041108, -0.041021, -0.041375, -0.042015, -0.042754, -0.043211, -0.043575, -0.043372, -0.043113, -0.04272, -0.042469, -0.042371, -0.043049, -0.044108, -0.045783, -0.047531, -0.048566, -0.049344, -0.049251, -0.048995, -0.048507, -0.047908, -0.047235, -0.044982, -0.042294, -0.038077, -0.034126, -0.031894, -0.031172, -0.033376, -0.036637, -0.04085, -0.043905, -0.046491, -0.046945, -0.047113, -0.046816, -0.046461, -0.04595, -0.044762, -0.042762, -0.039957, -0.036698, -0.0345, -0.032548
#*# 	  -0.045852, -0.04487, -0.043775, -0.042184, -0.040866, -0.040011, -0.040028, -0.040738, -0.041939, -0.04331, -0.044125, -0.044747, -0.044204, -0.043512, -0.042476, -0.041712, -0.041238, -0.041855, -0.04301, -0.044915, -0.046912, -0.048136, -0.04911, -0.049233, -0.049239, -0.049077, -0.048738, -0.048279, -0.046214, -0.043706, -0.039724, -0.035988, -0.033848, -0.033082, -0.034978, -0.037805, -0.041471, -0.044113, -0.04634, -0.046576, -0.046537, -0.045979, -0.045388, -0.044706, -0.043353, -0.041193, -0.038189, -0.034707, -0.032361, -0.030279
#*# 	  -0.048193, -0.046778, -0.045199, -0.042905, -0.041004, -0.039769, -0.039779, -0.04078, -0.042479, -0.044419, -0.045583, -0.046486, -0.045815, -0.044951, -0.043632, -0.042641, -0.041998, -0.042583, -0.043773, -0.045774, -0.047879, -0.049225, -0.050381, -0.050889, -0.051376, -0.051835, -0.051976, -0.051903, -0.050015, -0.047626, -0.043751, -0.040113, -0.038026, -0.037301, -0.039217, -0.042047, -0.045702, -0.04826, -0.050373, -0.049896, -0.049035, -0.047217, -0.045522, -0.044163, -0.042687, -0.04107, -0.038944, -0.03653, -0.034918, -0.033493
#*# 	  -0.051327, -0.049362, -0.047169, -0.043982, -0.041339, -0.039617, -0.039605, -0.040954, -0.043253, -0.045883, -0.047474, -0.048722, -0.047923, -0.046879, -0.04526, -0.044028, -0.043205, -0.043754, -0.044977, -0.047078, -0.049295, -0.050782, -0.05216, -0.053168, -0.054282, -0.05555, -0.056317, -0.056747, -0.055089, -0.052855, -0.049121, -0.045613, -0.043598, -0.042941, -0.044911, -0.047785, -0.051473, -0.053953, -0.055944, -0.054515, -0.052555, -0.049046, -0.045872, -0.043612, -0.041999, -0.041162, -0.040287, -0.039391, -0.038823, -0.038329
#*# 	  -0.055133, -0.052518, -0.049601, -0.045359, -0.041839, -0.039542, -0.039494, -0.041238, -0.044227, -0.047648, -0.04973, -0.051379, -0.050451, -0.049223, -0.047289, -0.045802, -0.04479, -0.045298, -0.046554, -0.048757, -0.051091, -0.052735, -0.05437, -0.055974, -0.057838, -0.060075, -0.061591, -0.062624, -0.061241, -0.059193, -0.055627, -0.052275, -0.05035, -0.049781, -0.051837, -0.054788, -0.058546, -0.060953, -0.062813, -0.060233, -0.056938, -0.051374, -0.046404, -0.043055, -0.041291, -0.041436, -0.042129, -0.043132, -0.043866, -0.044537
#*# 	  -0.057477, -0.054504, -0.051188, -0.046365, -0.042361, -0.039746, -0.039674, -0.041628, -0.044984, -0.048828, -0.051172, -0.053034, -0.052031, -0.050696, -0.048584, -0.046953, -0.045834, -0.046314, -0.047581, -0.049833, -0.052222, -0.05395, -0.055729, -0.057678, -0.059978, -0.062779, -0.064738, -0.066131, -0.064967, -0.063096, -0.05974, -0.056583, -0.05477, -0.054269, -0.056312, -0.059215, -0.062894, -0.065172, -0.066882, -0.063615, -0.059536, -0.052778, -0.046768, -0.042794, -0.040969, -0.04173, -0.043401, -0.045584, -0.047128, -0.048522
#*# 	  -0.058937, -0.055832, -0.052369, -0.04733, -0.043146, -0.04041, -0.040323, -0.042345, -0.045823, -0.049806, -0.052233, -0.054158, -0.053099, -0.051692, -0.049469, -0.047749, -0.046563, -0.047017, -0.048279, -0.05054, -0.052942, -0.054704, -0.056545, -0.058659, -0.061171, -0.06425, -0.06644, -0.068034, -0.067115, -0.065503, -0.06252, -0.059712, -0.058094, -0.057663, -0.059533, -0.062171, -0.0655, -0.06749, -0.068937, -0.065303, -0.06083, -0.053512, -0.047017, -0.042768, -0.040968, -0.042116, -0.044382, -0.04728, -0.049312, -0.051142
#*# 	  -0.058405, -0.055698, -0.052679, -0.048285, -0.044637, -0.04225, -0.042169, -0.043925, -0.046943, -0.0504, -0.052487, -0.05412, -0.053042, -0.051632, -0.049446, -0.047754, -0.046589, -0.047018, -0.048233, -0.050413, -0.052728, -0.054405, -0.056124, -0.057983, -0.060185, -0.062874, -0.064807, -0.066233, -0.065653, -0.064519, -0.062346, -0.060296, -0.059095, -0.058742, -0.060034, -0.061848, -0.064133, -0.065417, -0.066296, -0.063032, -0.059075, -0.052678, -0.047004, -0.043299, -0.041734, -0.042744, -0.044736, -0.047282, -0.049068, -0.050676
#*# 	  -0.057303, -0.055216, -0.052886, -0.049497, -0.046681, -0.044835, -0.044764, -0.046105, -0.048407, -0.051042, -0.052602, -0.053787, -0.052703, -0.051318, -0.04923, -0.047616, -0.046506, -0.046906, -0.048048, -0.050096, -0.052269, -0.053809, -0.055328, -0.056779, -0.058482, -0.060543, -0.062053, -0.063192, -0.063068, -0.062596, -0.061553, -0.060561, -0.059944, -0.059697, -0.060168, -0.060818, -0.061629, -0.061927, -0.062017, -0.059371, -0.056248, -0.051318, -0.046946, -0.044097, -0.042877, -0.043617, -0.045101, -0.047005, -0.048343, -0.049547
#*# 	  -0.055869, -0.054529, -0.053035, -0.050858, -0.049048, -0.047857, -0.047796, -0.048635, -0.050071, -0.051714, -0.052637, -0.053282, -0.0522, -0.050857, -0.048902, -0.047394, -0.046361, -0.046727, -0.047782, -0.049668, -0.051668, -0.053038, -0.054313, -0.055266, -0.05636, -0.057654, -0.058642, -0.059426, -0.059828, -0.060124, -0.060399, -0.060641, -0.060704, -0.060578, -0.060089, -0.059375, -0.058461, -0.057608, -0.056781, -0.054896, -0.052794, -0.049649, -0.046862, -0.045051, -0.044241, -0.044634, -0.045474, -0.046566, -0.047336, -0.048032
#*# 	  -0.054842, -0.053974, -0.053005, -0.051593, -0.050414, -0.049632, -0.049562, -0.050057, -0.050909, -0.051885, -0.052388, -0.052685, -0.051661, -0.050414, -0.048642, -0.047278, -0.04635, -0.046699, -0.047676, -0.049417, -0.05126, -0.052496, -0.053601, -0.054259, -0.054996, -0.055845, -0.056536, -0.057122, -0.057876, -0.058676, -0.059809, -0.060854, -0.061362, -0.061329, -0.060245, -0.058685, -0.056697, -0.055125, -0.053721, -0.052272, -0.050765, -0.048666, -0.04681, -0.045615, -0.045065, -0.045293, -0.045808, -0.046485, -0.046965, -0.047399
#*# 	  -0.053923, -0.053393, -0.0528, -0.051933, -0.051202, -0.050703, -0.050581, -0.05076, -0.051093, -0.051479, -0.051629, -0.051649, -0.050804, -0.049793, -0.04839, -0.04732, -0.046603, -0.046946, -0.047812, -0.049333, -0.050941, -0.052012, -0.052955, -0.053459, -0.054019, -0.054662, -0.055234, -0.055759, -0.056853, -0.058105, -0.059982, -0.061726, -0.062628, -0.062706, -0.061186, -0.058993, -0.056194, -0.054061, -0.052199, -0.050928, -0.049695, -0.048119, -0.046734, -0.045867, -0.045516, -0.045785, -0.046314, -0.04699, -0.047463, -0.04789
#*# 	  -0.053192, -0.052762, -0.052281, -0.051571, -0.050961, -0.050521, -0.050274, -0.050181, -0.050107, -0.05004, -0.049954, -0.049825, -0.049376, -0.048853, -0.048156, -0.047644, -0.04733, -0.047689, -0.048378, -0.049547, -0.050781, -0.051631, -0.052425, -0.053024, -0.053731, -0.054593, -0.055363, -0.056073, -0.057488, -0.059099, -0.061524, -0.063781, -0.064987, -0.065212, -0.063535, -0.061086, -0.057942, -0.055532, -0.05342, -0.051866, -0.050335, -0.048348, -0.046614, -0.045564, -0.0453, -0.045982, -0.047131, -0.048542, -0.049518, -0.050391
#*# 	  -0.052206, -0.051852, -0.051453, -0.050856, -0.050326, -0.04991, -0.049482, -0.049045, -0.048467, -0.047841, -0.047477, -0.047186, -0.047316, -0.047502, -0.047822, -0.048116, -0.048384, -0.048769, -0.049212, -0.049887, -0.050594, -0.051139, -0.051739, -0.052521, -0.053495, -0.05474, -0.055842, -0.056847, -0.058666, -0.060709, -0.063779, -0.066644, -0.068215, -0.06864, -0.066846, -0.064184, -0.06074, -0.058064, -0.055699, -0.053676, -0.05163, -0.048895, -0.046517, -0.045112, -0.044939, -0.046245, -0.048344, -0.050888, -0.052636, -0.054198
#*# 	  -0.051135, -0.050844, -0.050514, -0.05001, -0.049542, -0.049136, -0.048514, -0.04772, -0.046622, -0.045419, -0.044772, -0.044322, -0.045079, -0.046034, -0.047453, -0.048619, -0.049516, -0.049933, -0.050112, -0.050257, -0.0504, -0.05062, -0.051016, -0.052005, -0.053278, -0.054954, -0.056422, -0.057752, -0.059984, -0.062466, -0.066186, -0.069663, -0.071604, -0.072242, -0.070358, -0.067518, -0.063815, -0.060898, -0.058298, -0.05576, -0.053142, -0.049567, -0.046467, -0.04466, -0.044575, -0.046562, -0.049695, -0.053475, -0.056066, -0.05838
#*# 	  -0.050214, -0.049963, -0.049676, -0.04923, -0.048803, -0.048407, -0.047679, -0.046687, -0.045302, -0.04378, -0.042982, -0.042455, -0.043603, -0.045035, -0.047133, -0.048837, -0.050124, -0.050567, -0.050597, -0.050432, -0.050244, -0.050272, -0.050541, -0.051637, -0.053065, -0.054965, -0.056623, -0.058118, -0.060536, -0.06321, -0.067211, -0.070955, -0.073066, -0.07383, -0.071984, -0.069168, -0.065478, -0.062544, -0.059915, -0.057144, -0.054258, -0.050275, -0.046824, -0.044825, -0.044807, -0.047172, -0.050875, -0.055332, -0.058385, -0.06111
#*# 	  -0.048861, -0.048648, -0.048403, -0.048019, -0.047642, -0.047279, -0.046542, -0.045508, -0.044059, -0.042467, -0.041655, -0.041146, -0.04253, -0.044246, -0.04674, -0.048759, -0.050273, -0.050753, -0.050723, -0.050419, -0.05008, -0.050005, -0.050185, -0.05124, -0.052622, -0.054471, -0.05608, -0.057529, -0.059832, -0.06237, -0.066171, -0.069732, -0.071766, -0.072579, -0.071029, -0.068626, -0.065455, -0.062912, -0.060624, -0.05806, -0.05537, -0.05163, -0.048396, -0.046543, -0.046628, -0.049043, -0.052795, -0.057299, -0.06038, -0.06313
#*# 	  -0.046972, -0.046795, -0.046592, -0.046273, -0.04596, -0.045657, -0.04503, -0.044146, -0.042913, -0.041558, -0.0409, -0.040527, -0.041958, -0.04372, -0.046257, -0.048313, -0.049856, -0.050382, -0.050407, -0.050174, -0.049907, -0.049839, -0.049976, -0.050807, -0.051895, -0.053349, -0.054616, -0.055758, -0.057572, -0.059571, -0.062574, -0.065395, -0.067044, -0.067813, -0.066877, -0.065369, -0.063345, -0.061699, -0.060208, -0.058395, -0.056475, -0.053787, -0.051474, -0.050184, -0.050416, -0.052477, -0.055631, -0.0594, -0.061974, -0.06427
#*# 	  -0.044136, -0.044022, -0.043891, -0.043684, -0.043479, -0.043279, -0.042843, -0.042218, -0.041355, -0.04041, -0.040006, -0.039845, -0.041259, -0.042985, -0.045442, -0.047437, -0.048941, -0.049541, -0.049695, -0.049658, -0.049591, -0.049593, -0.049702, -0.050177, -0.050793, -0.051608, -0.052322, -0.052966, -0.053993, -0.055126, -0.056846, -0.058475, -0.059499, -0.060179, -0.06019, -0.060063, -0.059813, -0.059558, -0.059302, -0.058669, -0.057964, -0.056934, -0.05607, -0.055661, -0.056094, -0.057542, -0.059675, -0.062196, -0.063908, -0.065433
#*# 	  -0.041209, -0.041173, -0.041131, -0.041062, -0.040988, -0.040906, -0.040665, -0.040297, -0.039797, -0.039251, -0.039091, -0.039131, -0.040504, -0.042164, -0.0445, -0.046404, -0.047849, -0.048529, -0.048833, -0.049028, -0.049202, -0.049296, -0.049396, -0.049517, -0.04966, -0.049833, -0.049989, -0.050133, -0.050367, -0.050627, -0.051055, -0.051483, -0.051878, -0.052466, -0.05343, -0.054694, -0.056228, -0.057372, -0.058357, -0.058902, -0.059407, -0.060028, -0.060607, -0.061072, -0.061698, -0.062517, -0.063612, -0.064862, -0.065699, -0.06644
#*# 	  -0.038901, -0.038991, -0.039092, -0.039234, -0.039346, -0.039407, -0.039294, -0.039044, -0.038694, -0.03831, -0.038236, -0.038338, -0.039619, -0.041164, -0.04333, -0.045107, -0.04647, -0.047233, -0.047701, -0.048162, -0.048614, -0.048848, -0.049011, -0.048931, -0.048798, -0.048587, -0.048407, -0.048248, -0.047997, -0.047721, -0.047354, -0.047043, -0.047054, -0.047596, -0.049169, -0.051318, -0.053987, -0.056012, -0.057776, -0.059006, -0.060208, -0.061764, -0.063158, -0.06411, -0.06482, -0.065238, -0.06568, -0.066136, -0.066426, -0.066678
#*# 	  -0.035988, -0.036488, -0.037045, -0.037854, -0.038522, -0.038953, -0.038903, -0.03847, -0.037775, -0.036989, -0.036618, -0.036429, -0.037402, -0.038602, -0.040331, -0.041784, -0.042944, -0.043893, -0.044738, -0.045838, -0.046961, -0.047612, -0.048106, -0.048062, -0.047933, -0.047683, -0.047459, -0.047252, -0.046895, -0.046496, -0.045942, -0.045459, -0.045394, -0.045979, -0.047823, -0.050346, -0.053483, -0.055837, -0.057875, -0.059084, -0.060221, -0.061617, -0.062862, -0.063694, -0.064274, -0.064554, -0.064813, -0.06506, -0.065211, -0.065341
#*# 	  -0.032552, -0.033706, -0.034992, -0.03686, -0.038405, -0.039403, -0.039359, -0.038484, -0.037014, -0.035339, -0.034339, -0.033553, -0.034033, -0.034687, -0.035748, -0.036708, -0.03756, -0.038785, -0.040192, -0.042252, -0.044386, -0.045695, -0.046751, -0.046947, -0.047065, -0.047074, -0.047058, -0.047025, -0.046889, -0.046725, -0.04651, -0.046347, -0.046474, -0.047178, -0.048999, -0.051455, -0.054483, -0.056689, -0.058561, -0.059138, -0.059554, -0.059843, -0.060104, -0.060288, -0.060555, -0.060922, -0.061404, -0.061952, -0.062318, -0.062641
#*# 	  -0.027463, -0.029617, -0.032018, -0.035506, -0.038389, -0.04025, -0.040191, -0.038603, -0.035897, -0.032803, -0.030803, -0.029073, -0.028793, -0.028609, -0.028647, -0.028851, -0.029232, -0.030867, -0.033119, -0.036626, -0.040285, -0.042594, -0.04452, -0.045139, -0.045711, -0.046217, -0.046606, -0.046916, -0.047239, -0.047564, -0.048059, -0.048562, -0.049077, -0.04998, -0.051633, -0.053789, -0.056397, -0.058176, -0.059619, -0.059049, -0.058176, -0.056517, -0.055049, -0.054105, -0.053855, -0.054438, -0.055402, -0.056581, -0.057394, -0.058121
#*# 	  -0.022669, -0.025728, -0.02914, -0.034094, -0.03819, -0.040832, -0.040761, -0.038529, -0.034705, -0.030329, -0.027425, -0.024841, -0.023873, -0.022929, -0.02204, -0.021559, -0.021512, -0.023512, -0.02652, -0.031324, -0.036351, -0.039561, -0.042272, -0.043288, -0.044289, -0.04527, -0.046047, -0.046687, -0.047448, -0.048244, -0.04942, -0.050562, -0.051448, -0.052537, -0.054017, -0.055869, -0.058055, -0.059414, -0.060437, -0.058795, -0.056722, -0.053249, -0.050173, -0.04818, -0.04745, -0.048238, -0.049654, -0.051425, -0.052656, -0.053762
#*# 	  -0.019224, -0.022816, -0.02682, -0.032636, -0.037444, -0.040547, -0.040476, -0.037879, -0.033417, -0.028308, -0.024886, -0.021812, -0.020441, -0.019051, -0.017617, -0.016731, -0.016428, -0.018624, -0.022051, -0.027578, -0.033369, -0.037088, -0.040253, -0.041533, -0.042829, -0.044147, -0.045201, -0.046078, -0.047153, -0.048282, -0.049943, -0.05154, -0.052688, -0.053901, -0.055238, -0.056848, -0.058704, -0.059749, -0.060466, -0.058126, -0.055275, -0.050634, -0.046523, -0.043856, -0.042816, -0.043733, -0.045437, -0.047586, -0.049085, -0.050431
#*# 	  -0.016386, -0.019795, -0.023596, -0.029119, -0.033692, -0.036654, -0.03665, -0.034284, -0.030199, -0.025517, -0.022384, -0.019578, -0.018377, -0.017168, -0.015942, -0.015199, -0.014969, -0.016967, -0.020061, -0.02505, -0.030279, -0.033668, -0.036599, -0.037969, -0.039414, -0.040965, -0.042215, -0.043261, -0.044508, -0.045812, -0.04772, -0.049546, -0.05082, -0.052067, -0.05326, -0.054659, -0.056241, -0.05708, -0.057618, -0.055183, -0.052245, -0.0475, -0.043296, -0.040566, -0.039478, -0.040365, -0.042037, -0.044152, -0.04563, -0.046958
#*# 	  -0.013911, -0.016709, -0.019831, -0.024371, -0.028139, -0.0306, -0.030702, -0.028927, -0.025826, -0.022264, -0.019905, -0.01782, -0.017131, -0.016479, -0.015913, -0.01564, -0.01568, -0.017243, -0.019556, -0.023253, -0.027126, -0.029681, -0.031964, -0.033321, -0.034828, -0.03655, -0.037945, -0.039121, -0.040457, -0.041838, -0.043851, -0.045773, -0.047091, -0.048317, -0.049368, -0.050572, -0.051915, -0.052613, -0.053048, -0.050879, -0.048267, -0.044055, -0.040322, -0.037896, -0.036917, -0.037678, -0.039126, -0.040961, -0.042245, -0.043398
#*# 	  -0.010661, -0.012309, -0.014149, -0.016836, -0.019084, -0.020592, -0.020862, -0.020147, -0.018821, -0.017284, -0.016328, -0.015547, -0.015791, -0.016152, -0.016789, -0.01738, -0.017921, -0.018732, -0.019677, -0.021105, -0.022597, -0.023677, -0.024797, -0.026055, -0.027575, -0.02947, -0.03102, -0.032339, -0.033758, -0.035205, -0.037306, -0.039307, -0.040652, -0.041824, -0.042662, -0.043588, -0.044593, -0.045114, -0.04544, -0.043868, -0.041974, -0.038913, -0.036198, -0.034431, -0.033706, -0.034234, -0.035252, -0.036545, -0.03745, -0.038265
#*# 	  -0.007946, -0.00858, -0.009293, -0.010345, -0.011254, -0.011918, -0.012322, -0.012519, -0.012726, -0.012937, -0.013188, -0.013532, -0.014564, -0.015782, -0.017434, -0.018753, -0.019718, -0.019904, -0.019707, -0.01924, -0.018741, -0.018584, -0.018722, -0.019866, -0.02136, -0.023351, -0.024994, -0.026404, -0.027894, -0.029405, -0.031601, -0.033689, -0.03507, -0.036203, -0.036859, -0.037544, -0.038257, -0.038627, -0.038859, -0.037814, -0.036552, -0.034503, -0.032685, -0.031498, -0.030999, -0.031327, -0.031972, -0.032795, -0.033373, -0.033892
#*# 	  -0.006234, -0.00612, -0.005998, -0.005841, -0.005755, -0.005788, -0.006263, -0.00709, -0.008363, -0.009791, -0.010881, -0.012, -0.01355, -0.015326, -0.017634, -0.019425, -0.020666, -0.020466, -0.019557, -0.017901, -0.016154, -0.015213, -0.014713, -0.015721, -0.017116, -0.01906, -0.020683, -0.02209, -0.023627, -0.0252, -0.027504, -0.029693, -0.031125, -0.03225, -0.03278, -0.033298, -0.033804, -0.034069, -0.034237, -0.033581, -0.032785, -0.031481, -0.030323, -0.029563, -0.029234, -0.029424, -0.029808, -0.0303, -0.030646, -0.030958
#*# 	  -0.006573, -0.006018, -0.005403, -0.004524, -0.003829, -0.003443, -0.003788, -0.004713, -0.006203, -0.00789, -0.009137, -0.010375, -0.011802, -0.013426, -0.015514, -0.017152, -0.018311, -0.018358, -0.017858, -0.016847, -0.015772, -0.015188, -0.014874, -0.015483, -0.016337, -0.017539, -0.018606, -0.019582, -0.021155, -0.022891, -0.025557, -0.028092, -0.02975, -0.031011, -0.031503, -0.031947, -0.03235, -0.032558, -0.032688, -0.032215, -0.031639, -0.030688, -0.029845, -0.029295, -0.029071, -0.029242, -0.029566, -0.029977, -0.030264, -0.030523
#*# 	  -0.007826, -0.006949, -0.005973, -0.00456, -0.003402, -0.002677, -0.002797, -0.003592, -0.004936, -0.00647, -0.007584, -0.008657, -0.009677, -0.010833, -0.012308, -0.013514, -0.014434, -0.015014, -0.015426, -0.015886, -0.016346, -0.016631, -0.01687, -0.016951, -0.017051, -0.017179, -0.017437, -0.017782, -0.019385, -0.021335, -0.024486, -0.027486, -0.029453, -0.030918, -0.031408, -0.031819, -0.032159, -0.03233, -0.032433, -0.032059, -0.031604, -0.030848, -0.03018, -0.029751, -0.029609, -0.029811, -0.030162, -0.030598, -0.0309, -0.031171
#*# 	  -0.010208, -0.008967, -0.00758, -0.005555, -0.003858, -0.002716, -0.002467, -0.002928, -0.003828, -0.004881, -0.005613, -0.006271, -0.006543, -0.006844, -0.007218, -0.007646, -0.008131, -0.009635, -0.01164, -0.014673, -0.017821, -0.019644, -0.020887, -0.020153, -0.019073, -0.017499, -0.016471, -0.01581, -0.017449, -0.019723, -0.023618, -0.027333, -0.029778, -0.031566, -0.032081, -0.032476, -0.032761, -0.032897, -0.032973, -0.032686, -0.032336, -0.03175, -0.031236, -0.03092, -0.030874, -0.031153, -0.031599, -0.032138, -0.032508, -0.032839
#*# 	  -0.012195, -0.01066, -0.008942, -0.006422, -0.004287, -0.002806, -0.002249, -0.00243, -0.002953, -0.003596, -0.004006, -0.004314, -0.003961, -0.003552, -0.003008, -0.002788, -0.002911, -0.005183, -0.008513, -0.013684, -0.019067, -0.022169, -0.024248, -0.022841, -0.020785, -0.017804, -0.015712, -0.014219, -0.015887, -0.018429, -0.022938, -0.027242, -0.030082, -0.032138, -0.032675, -0.033058, -0.033301, -0.033409, -0.033462, -0.033243, -0.032977, -0.032524, -0.032133, -0.031906, -0.031939, -0.032283, -0.032809, -0.033437, -0.033865, -0.034247
#*# 	  -0.013684, -0.011942, -0.009991, -0.007124, -0.004681, -0.002959, -0.002176, -0.002141, -0.002373, -0.002698, -0.00286, -0.002899, -0.002081, -0.001141, 8.5e-05, 0.000788, 0.000935, -0.001907, -0.006219, -0.012979, -0.020021, -0.024074, -0.026777, -0.024878, -0.022105, -0.01809, -0.015217, -0.013111, -0.0148, -0.017537, -0.022497, -0.027232, -0.030361, -0.032614, -0.033169, -0.033545, -0.03376, -0.033849, -0.033888, -0.033714, -0.033502, -0.033139, -0.032828, -0.032662, -0.03275, -0.033144, -0.033733, -0.03443, -0.034904, -0.035327
#*# 	  -0.013975, -0.012193, -0.010197, -0.007261, -0.004759, -0.002989, -0.002162, -0.002085, -0.00226, -0.002522, -0.002635, -0.002622, -0.001713, -0.000669, 0.000691, 0.001489, 0.001688, -0.001265, -0.00577, -0.01284, -0.020208, -0.024448, -0.027272, -0.025276, -0.022364, -0.018146, -0.01512, -0.012894, -0.014588, -0.017362, -0.02241, -0.02723, -0.030416, -0.032707, -0.033266, -0.033641, -0.03385, -0.033936, -0.033971, -0.033806, -0.033605, -0.033259, -0.032964, -0.03281, -0.032909, -0.033313, -0.033913, -0.034624, -0.035108, -0.035538
#*# 	  -0.013975, -0.012193, -0.010197, -0.007261, -0.004759, -0.002989, -0.002162, -0.002085, -0.00226, -0.002522, -0.002635, -0.002622, -0.001713, -0.000669, 0.000691, 0.001489, 0.001688, -0.001265, -0.00577, -0.01284, -0.020208, -0.024448, -0.027272, -0.025276, -0.022364, -0.018146, -0.01512, -0.012894, -0.014588, -0.017362, -0.02241, -0.02723, -0.030416, -0.032707, -0.033266, -0.033641, -0.03385, -0.033936, -0.033971, -0.033806, -0.033605, -0.033259, -0.032964, -0.03281, -0.032909, -0.033313, -0.033913, -0.034624, -0.035108, -0.035538
#*# 	  -0.013975, -0.012193, -0.010197, -0.007261, -0.004759, -0.002989, -0.002162, -0.002085, -0.00226, -0.002522, -0.002635, -0.002622, -0.001713, -0.000669, 0.000691, 0.001489, 0.001688, -0.001265, -0.00577, -0.01284, -0.020208, -0.024448, -0.027272, -0.025276, -0.022364, -0.018146, -0.01512, -0.012894, -0.014588, -0.017362, -0.02241, -0.02723, -0.030416, -0.032707, -0.033266, -0.033641, -0.03385, -0.033936, -0.033971, -0.033806, -0.033605, -0.033259, -0.032964, -0.03281, -0.032909, -0.033313, -0.033913, -0.034624, -0.035108, -0.035538
#*# 	  -0.013975, -0.012193, -0.010197, -0.007261, -0.004759, -0.002989, -0.002162, -0.002085, -0.00226, -0.002522, -0.002635, -0.002622, -0.001713, -0.000669, 0.000691, 0.001489, 0.001688, -0.001265, -0.00577, -0.01284, -0.020208, -0.024448, -0.027272, -0.025276, -0.022364, -0.018146, -0.01512, -0.012894, -0.014588, -0.017362, -0.02241, -0.02723, -0.030416, -0.032707, -0.033266, -0.033641, -0.03385, -0.033936, -0.033971, -0.033806, -0.033605, -0.033259, -0.032964, -0.03281, -0.032909, -0.033313, -0.033913, -0.034624, -0.035108, -0.035538
#*# 	  -0.013975, -0.012193, -0.010197, -0.007261, -0.004759, -0.002989, -0.002162, -0.002085, -0.00226, -0.002522, -0.002635, -0.002622, -0.001713, -0.000669, 0.000691, 0.001489, 0.001688, -0.001265, -0.00577, -0.01284, -0.020208, -0.024448, -0.027272, -0.025276, -0.022364, -0.018146, -0.01512, -0.012894, -0.014588, -0.017362, -0.02241, -0.02723, -0.030416, -0.032707, -0.033266, -0.033641, -0.03385, -0.033936, -0.033971, -0.033806, -0.033605, -0.033259, -0.032964, -0.03281, -0.032909, -0.033313, -0.033913, -0.034624, -0.035108, -0.035538
#*# x_count = 50
#*# y_count = 50
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 35.0
#*# max_x = 265.0
#*# min_y = 35.0
#*# max_y = 265.0
